---
import Layout from '../layouts/Layout.astro';

---

<Layout title="Fligth form information">


	<form id="trableForm" class="max-w-md mx-2 mb-4 bg-slate-50 md:mx-auto mt-8 place-items-center border-2 rounded-lg border-gray-600 shadow-lg shadow-gray-700 p-8">
		<div class="grid md:grid-cols-2 md:gap-6">
			<div class="relative z-0 w-full mb-5 group">
				<input type="text" name="first_name" id="first_name" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
				<label for="first_name" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">First name</label>
			</div>
			<div class="relative z-0 w-full mb-5 group">
				<input type="text" name="last_name" id="last_name" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
				<label for="last_name" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Last name</label>
			</div>
		  </div>
		<div class="relative z-0 w-full mb-5 group">
			<input type="email" name="email" id="email" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
			<label for="email" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Email address</label>
		</div>
	
	
		  <div class="relative z-0 w-full mb-5 group">
			  <input type="tel" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" name="phone" id="phone" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
			  <label for="phone" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Phone number (123-456-7890)</label>
		  </div>
		  <label  class="relative inline-flex items-center mb-5 cursor-pointer">
			<input name="needTransportation" type="checkbox" id="transportationCheck"  class="sr-only peer">
			<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:w-5 after:h-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
			<span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Do you need transportation to the airport?</span>
		  </label>
		  <div id="needTransportation" class="gap-y-4" style="display: none;">

			<div class="hidden ">
				<div class="days">
					<div class="days-of-week grid grid-cols-7 mb-1 dow block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm"></div>
					<div class="datepicker-grid w-64 grid grid-cols-7 block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm h-6 leading-6 text-sm font-medium text-gray-500 dark:text-gray-400"></div>
				</div>
				<div class="calendar-weeks">
					<div class="days-of-week flex"><span class="dow h-6 leading-6 text-sm font-medium text-gray-500 dark:text-gray-400"></span></div>
					<div class="weeks week block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm"></div>
				</div>
			</div>
			<div class="relative max-w-sm">
				<div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
				   <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
					  <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
					</svg>
				</div>
				<input  name="dayLeaving" datepicker datepicker-autohide type="text" class=" bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date you leave">
			  </div>

			  <div class="grid md:grid-cols-2 md:gap-6">
				<div class="relative z-0 w-full mb-5 group">
					<label   for="number-input" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Hour</label>
					<input name="hourLeaving" type="number" id="number-input" aria-describedby="helper-text-explanation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="13">					
				</div>
				<div class="relative z-0 w-full mb-5 group">
					<label for="number-input" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Minute</label>
					<input name="minuteLeaving" type="number" id="number-input" aria-describedby="helper-text-explanation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="30">					
				</div>
			  </div>

			  
			<div class="hidden ">
				<div class="days">
					<div class="days-of-week grid grid-cols-7 mb-1 dow block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm"></div>
					<div class="datepicker-grid w-64 grid grid-cols-7 block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm h-6 leading-6 text-sm font-medium text-gray-500 dark:text-gray-400"></div>
				</div>
				<div class="calendar-weeks">
					<div class="days-of-week flex"><span class="dow h-6 leading-6 text-sm font-medium text-gray-500 dark:text-gray-400"></span></div>
					<div class="weeks week block flex-1 leading-9 border-0 rounded-lg cursor-default text-center text-gray-900 font-semibold text-sm"></div>
				</div>
			</div>
			<div class="relative max-w-sm">
				<div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
				   <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
					  <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
					</svg>
				</div>
				<input name="dayCommingBack" datepicker datepicker-autohide type="text" class=" bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date you come back">
			  </div>

			  <div class="grid md:grid-cols-2 md:gap-6">
				<div class="relative z-0 w-full mb-5 group">
					<label for="number-input" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Hour</label>
					<input name="hourCommingBack" type="number" id="number-input" aria-describedby="helper-text-explanation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="13">					
				</div>
				<div class="relative z-0 w-full mb-5 group">
					<label for="number-input" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Minute</label>
					<input name="minuteCommingBack" type="number" id="number-input" aria-describedby="helper-text-explanation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="30">					
				</div>
			  </div>
			  <div class="relative z-0 w-full mb-5 group">
				<input type="text" name="flightNumber"  id="fligth_number" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
				<label  for="fligth_number" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Fligth Number</label>
			</div>
		  </div>
			
		  <hr class="mt-6 mb-4 border-slate-600">
		<button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Submit</button>
		
	</form>
	  
</Layout>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/datepicker.min.js"></script>
<script>	
import {client} from '../lib/tursoDb'	
const transportationCheck = document.getElementById('transportationCheck');
const needTransportationElement = document.getElementById('needTransportation');
transportationCheck.addEventListener('click', () => {
	console.log(transportationCheck)
	needTransportationElement.style.display = transportationCheck.checked ? 'grid' : 'none';
});
const trableForm = document.getElementById('trableForm');

trableForm.addEventListener('submit', async (e) => {
	e.preventDefault();
	const formData = new FormData(trableForm);
	const data = Object.fromEntries(formData.entries());
	const Objectdata = {
		first_name: data.first_name,
		last_name: data.last_name,
		email: data.email,
		phone: data.phone,
		needTransportation: data.needTransportation,
		dayLeaving: data.dayLeaving,
		hourLeaving: data.hourLeaving,
		minuteLeaving: data.minuteLeaving,
		dayCommingBack: data.dayCommingBack,
		hourCommingBack: data.hourCommingBack,
		minuteCommingBack: data.minuteCommingBack,
		flightNumber: data.flightNumber,
	}
	try {

		await client.execute(`
  CREATE TABLE IF NOT EXISTS flightInformation (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    phone TEXT NOT NULL,
    needTransportation TEXT,
    dayLeaving TEXT,
    hourLeaving TEXT,
    minuteLeaving TEXT,
    dayCommingBack TEXT,
    hourCommingBack TEXT,
    minuteCommingBack TEXT,
    flightNumber TEXT
  );
`);

await client.execute({
  sql: `
    INSERT INTO flightInformation 
    (first_name, last_name, email, phone, needTransportation, dayLeaving, hourLeaving, minuteLeaving, dayCommingBack, hourCommingBack, minuteCommingBack, flightNumber) 
    VALUES 
    (:first_name, :last_name, :email, :phone, :needTransportation, :dayLeaving, :hourLeaving, :minuteLeaving, :dayCommingBack, :hourCommingBack, :minuteCommingBack, :flightNumber)
  `,
  args: {
    first_name: String(data.first_name),
    last_name: String(data.last_name),
    email: String(data.email),
    phone: String(data.phone),
    needTransportation: String(data.needTransportation),
    dayLeaving: String(data.dayLeaving),
    hourLeaving: String(data.hourLeaving),
    minuteLeaving: String(data.minuteLeaving),
    dayCommingBack: String(data.dayCommingBack),
    hourCommingBack: String(data.hourCommingBack),
    minuteCommingBack: String(data.minuteCommingBack),
    flightNumber: String(data.flightNumber),
  },
});
		
		window.location.href = '/success'


} catch (err) {
	alert(err.message)
}
}
);

</script>